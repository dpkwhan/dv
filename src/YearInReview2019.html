<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <title>Year In Review: 2019</title>
    <link href="https://fonts.googleapis.com/css?family=Lobster+Two:400,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/normalize.css@7/normalize.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/antd@3.22.0/dist/antd.css" rel="stylesheet" type="text/css" />
    <style>
      html body * {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
          "Helvetica Neue", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      }

      .comments {
        margin-top: 50px;
      }

      .comments-content {
        margin-top: 0px;
        border: 1px dashed #e9e9e9;
        border-radius: 6px;
        background-color: #fafafa;
        text-align: left;
        padding-top: 10px;
        padding-left: 10px;
        height: "50vh";
      }

      .comment-item li {
        margin: 10px 0px 10px 0px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- react -->
    <script src="https://unpkg.com/prop-types@15/prop-types.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>

    <!-- spectacle -->
    <script src="https://unpkg.com/@babel/standalone/babel.js"></script>
    <script src="https://unpkg.com/spectacle@^5/dist/spectacle.js"></script>
    <script src="https://unpkg.com/spectacle@^5/lib/one-page.js"></script>

    <!-- echarts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/4.2.1/echarts.min.js"></script>

    <!-- numeral -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>

    <!-- ant design -->
    <script src="https://unpkg.com/moment/min/moment-with-locales.js"></script>
    <script src="https://unpkg.com/antd@3.22.0/dist/antd-with-locales.min.js"></script>

    <!-- lodash -->
    <script src="https://unpkg.com/lodash@4.17.15/lodash.js"></script>

    <!-- styled-componenets -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/styled-components/4.3.2/styled-components.min.js"></script>

    <script type="text/spectacle">
      () => {

        var wontBind = ['constructor', 'render', 'componentWillMount',
          'componentDidMount', 'componentWillReceiveProps',
          'shouldComponentUpdate', 'componentWillUpdate',
          'componentDidUpdate', 'componentWillUnmount'
        ];
        var toBind = [];

        function autoBind(context) {
          if (context === undefined) {
            console.error('Autobind error: No context provided.');
            return;
          }

          var objPrototype = Object.getPrototypeOf(context);

          if (arguments.length > 1) {
            // If a list of methods to bind is provided, use it.
            toBind = Array.prototype.slice.call(arguments, 1);
          } else {
            // If no list of methods to bind is provided, bind all available methods in class.
            toBind = Object.getOwnPropertyNames(objPrototype);
          }

          toBind.forEach(function (method) {
            var descriptor = Object.getOwnPropertyDescriptor(objPrototype, method);

            if (descriptor === undefined) {
              console.warn('Autobind: "' + method + '" method not found in class.');
              return;
            }

            // Return if it's special case function or if not a function at all
            if (wontBind.indexOf(method) !== -1 || typeof descriptor.value !== 'function') {
              return;
            }

            Object.defineProperty(objPrototype, method, boundMethod(objPrototype, method, descriptor));
          });
        }

        function boundMethod(objPrototype, method, descriptor) {
          var fn = descriptor.value;

          return {
            configurable: true,
            get: function get() {
              if (this === objPrototype || this.hasOwnProperty(method)) {
                return fn;
              }

              var boundFn = fn.bind(this);
              Object.defineProperty(this, method, {
                value: boundFn,
                configurable: true,
                writable: true
              });
              return boundFn;
            }
          };
        }

        // ECharts theme
        const macarons = {
          color: [
            "green",
            "blue",
            "#2ec7c9",
            "#b6a2de",
            "#5ab1ef",
            "#ffb980",
            "#d87a80",
            "#8d98b3",
            "#e5cf0d",
            "#97b552",
            "#95706d",
            "#dc69aa",
            "#07a2a4",
            "#9a7fd1",
            "#588dd5",
            "#f5994e",
            "#c05050",
            "#59678c",
            "#c9ab00",
            "#7eb00a",
            "#6f5553",
            "#c14089",
          ],

          title: {
            textStyle: {
              fontWeight: "normal",
              color: "#008acd",
            },
          },

          dataRange: {
            itemWidth: 15,
            color: ["#5ab1ef", "#e0ffff"],
          },

          toolbox: {
            color: ["#1e90ff", "#1e90ff", "#1e90ff", "#1e90ff"],
            effectiveColor: "#ff4500",
          },

          tooltip: {
            backgroundColor: "rgba(50,50,50,0.5)",
            axisPointer: {
              type: "line",
              lineStyle: {
                color: "#008acd",
              },
              crossStyle: {
                color: "#008acd",
              },
              shadowStyle: {
                color: "rgba(200,200,200,0.2)",
              },
            },
          },

          dataZoom: {
            dataBackgroundColor: "#efefff",
            fillerColor: "rgba(182,162,222,0.2)",
            handleColor: "#008acd",
          },

          grid: {
            borderColor: "#eee",
          },

          categoryAxis: {
            axisLine: {
              lineStyle: {
                color: "#008acd",
              },
            },
            splitLine: {
              lineStyle: {
                color: ["#eee"],
              },
            },
          },

          valueAxis: {
            axisLine: {
              lineStyle: {
                color: "#008acd",
              },
            },
            splitArea: {
              show: true,
              areaStyle: {
                color: ["rgba(250,250,250,0.1)", "rgba(200,200,200,0.1)"],
              },
            },
            splitLine: {
              lineStyle: {
                color: ["#eee"],
              },
            },
          },

          polar: {
            axisLine: {
              lineStyle: {
                color: "#ddd",
              },
            },
            splitArea: {
              show: true,
              areaStyle: {
                color: ["rgba(250,250,250,0.2)", "rgba(200,200,200,0.2)"],
              },
            },
            splitLine: {
              lineStyle: {
                color: "#ddd",
              },
            },
          },

          timeline: {
            lineStyle: {
              color: "#008acd",
            },
            controlStyle: {
              normal: { color: "#008acd" },
              emphasis: { color: "#008acd" },
            },
            symbol: "emptyCircle",
            symbolSize: 3,
          },

          bar: {
            itemStyle: {
              barBorderRadius: 5,
            },
          },

          line: {
            smooth: false,
            symbol: "emptyCircle",
            symbolSize: 5,
          },

          k: {
            itemStyle: {
              normal: {
                color: "#d87a80",
                color0: "#2ec7c9",
                lineStyle: {
                  color: "#d87a80",
                  color0: "#2ec7c9",
                },
              },
            },
          },

          scatter: {
            symbol: "circle",
            symbolSize: 4,
          },

          radar: {
            symbol: "emptyCircle",
            symbolSize: 3,
            //symbol: null,
            //symbolRotate : null,
          },

          map: {
            itemStyle: {
              normal: {
                areaStyle: {
                  color: "#ddd",
                },
                label: {
                  textStyle: {
                    color: "#d87a80",
                  },
                },
              },
              emphasis: {
                areaStyle: {
                  color: "#fe994e",
                },
              },
            },
          },

          force: {
            itemStyle: {
              normal: {
                linkStyle: {
                  color: "#1e90ff",
                },
              },
            },
          },

          chord: {
            itemStyle: {
              normal: {
                borderWidth: 1,
                borderColor: "rgba(128, 128, 128, 0.5)",
                chordStyle: {
                  lineStyle: {
                    color: "rgba(128, 128, 128, 0.5)",
                  },
                },
              },
              emphasis: {
                borderWidth: 1,
                borderColor: "rgba(128, 128, 128, 0.5)",
                chordStyle: {
                  lineStyle: {
                    color: "rgba(128, 128, 128, 0.5)",
                  },
                },
              },
            },
          },

          gauge: {
            axisLine: {
              lineStyle: {
                color: [[0.2, "#2ec7c9"], [0.8, "#5ab1ef"], [1, "#d87a80"]],
                width: 10,
              },
            },
            axisTick: {
              splitNumber: 10,
              length: 15,
              lineStyle: {
                color: "auto",
              },
            },
            splitLine: {
              length: 22,
              lineStyle: {
                color: "auto",
              },
            },
            pointer: {
              width: 5,
            },
          },

          textStyle: {
            fontFamily: "Arial, Verdana, sans-serif",
          },
        };

        const { Button, Row, Col, Radio, Steps, Divider, Icon } = antd;
        const Step = Steps.Step;
        const { Component, Fragment } = React;
        const { Heading } = Spectacle;

        const nasdaqLogo = <Icon component={() => <img src="https://new.nasdaq.com/themes/nsdq/dist/assets/images/logo.svg" style={{width: 147, height: 42}} />} />;
        const nyseLogo = <Icon component={() => <img src="https://upload.wikimedia.org/wikipedia/commons/9/93/NY_Stock_Exchange_logo.svg" style={{width: 40, height: 40}} />} />;

        // JSON data
        // 1. market_share_by_year_exch.json
        const jStrMarketShareByYearExch = `{"year":[2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019],"CBOE":[0.001553126,0.001517211,0.002513032,0.001154305,0.003647843,0.004147346,0.0008273976,0,0,0,0,0],"CBOE BYX":[0,0,0.001711023,0.02233438,0.0300008,0.01965342,0.03082055,0.04085694,0.04337259,0.04873961,0.04718219,0.04041712],"CBOE BZX":[0.01712512,0.1022285,0.1006168,0.09076816,0.08849648,0.08392778,0.07803235,0.07132131,0.06491506,0.05971903,0.06462826,0.05504694],"CBOE EDGA":[0,0,0.01792306,0.03571367,0.02584397,0.02998067,0.02694379,0.02663557,0.02571326,0.01798313,0.01366565,0.02165629],"CBOE EDGX":[0,0,0.01933663,0.05888192,0.06744347,0.0762213,0.06787677,0.07230856,0.07239488,0.06396302,0.05832063,0.04473561],"IEX":[0,0,0,0,0,0,0,0,0.005370828,0.02203966,0.02449299,0.02739987],"NASDAQ":[0.2994096,0.213259,0.1878663,0.180777,0.1703731,0.1562811,0.1710157,0.1587936,0.1399825,0.1416641,0.1589994,0.1735855],"NASDAQ BX":[0,0.01697694,0.03337244,0.02149014,0.02638685,0.02462354,0.02500902,0.01971339,0.02374147,0.03118962,0.02848183,0.01955371],"NASDAQ ISE":[0.01101148,0.0188405,0.008313444,0,0,0,0,0,0,0,0,0],"NASDAQ PSX":[0.0005673296,0,0.001162175,0.01019435,0.01086213,0.006940611,0.005658153,0.009635768,0.009957686,0.007769261,0.007597216,0.007304567],"NYSE":[0.1684241,0.1407456,0.1354423,0.1322114,0.1180604,0.1163867,0.1139094,0.1268429,0.1329333,0.1311558,0.1280733,0.1334676],"NYSE American":[0.004202999,0.001779399,0.002544374,0.003592237,0.00228655,0.002912972,0.003315428,0.002375266,0.002123802,0.002517418,0.003397272,0.00353351],"NYSE Arca":[0.1799778,0.1530225,0.1390412,0.131038,0.1196199,0.105742,0.1074679,0.1115833,0.1073326,0.09304159,0.09190951,0.08618862],"NYSE Chicago":[0.004294733,0.003916805,0.004019295,0.003377,0.004028267,0.004353622,0.004475207,0.005400293,0.004398395,0.004575037,0.005213556,0.004594182],"NYSE National":[0.01515979,0.0067369,0.006385692,0.005635292,0.003687354,0.00443541,0.001411458,5.160788e-008,9.235677e-005,1.3421e-005,0.004686542,0.0116567],"TRF":[0.298274,0.3409766,0.3397522,0.3028321,0.3292628,0.3643935,0.3632369,0.3545331,0.3676712,0.3756293,0.3633517,0.3708598]}`;
        const marketShareByYearExch = JSON.parse(jStrMarketShareByYearExch);

        // 2. market_share_by_year_ac.json
        const jStrMarketShareTapeAC = `{"month":["2018-04","2018-05","2018-06","2018-07","2018-08","2018-09","2018-10","2018-11","2018-12","2019-01","2019-02","2019-03","2019-04","2019-05","2019-06","2019-07","2019-08"],"nyseMarketShareInTapeC":[0.001902452,0.00928663,0.01102561,0.01394173,0.01260838,0.01211251,0.01473987,0.01584035,0.01902164,0.01810233,0.01803559,0.01964385,0.01816022,0.01892466,0.01652825,0.01512109,0.01688625],"nasdaqMarketShareInTapeA":[0.09872582,0.09790258,0.09709424,0.1071561,0.1092759,0.1037074,0.1232405,0.1233104,0.1203663,0.1229041,0.120053,0.1160292,0.1168928,0.1290458,0.1243864,0.1328388,0.1338272]}`;
        const marketShareTapeAC = JSON.parse(jStrMarketShareTapeAC);


        const CalendarStyled = styled.time`
          body {
            font-family: "Helvetica Neue Bold", arial, helvetica, sans-serif;
            font-size: 100%;
            margin: 10px;
            color: #333;
            background-color: #cecece;
          }

          h1 {
            margin: 0;
            font-weight: normal;
          }

          time.icon {
            font-size: 0.3em; /* change icon size */
            display: block;
            position: relative;
            width: 7em;
            height: 7em;
            background-color: #fff;
            // margin: 2em auto;
            border-radius: 0.6em;
            box-shadow: 0 1px 0 #bdbdbd, 0 2px 0 #fff, 0 3px 0 #bdbdbd, 0 4px 0 #fff,
              0 5px 0 #bdbdbd, 0 0 0 1px #bdbdbd;
            overflow: hidden;
            -webkit-backface-visibility: hidden;
            -webkit-transform: rotate(0deg) skewY(0deg);
            -webkit-transform-origin: 50% 10%;
            transform-origin: 50% 10%;
          }

          time.icon * {
            display: block;
            width: 100%;
            font-size: 1.2em;
            font-weight: bold;
            font-style: normal;
            text-align: center;
          }

          time.icon strong {
            position: absolute;
            top: 0;
            padding: 0.4em 0;
            color: #fff;
            background-color: #fd9f1b;
            border-bottom: 1px dashed #f37302;
            box-shadow: 0 2px 0 #fd9f1b;
          }

          time.icon em {
            position: absolute;
            bottom: 0.3em;
            color: #fd9f1b;
            font-size: 1em;
          }

          time.icon span {
            width: 100%;
            font-size: 2.5em;
            letter-spacing: -0.05em;
            padding-top: 0.8em;
            color: #2f2f2f;
          }

          time.icon:hover,
          time.icon:focus {
            -webkit-animation: swing 0.6s ease-out;
            animation: swing 0.6s ease-out;
          }

          @-webkit-keyframes swing {
            0% {
              -webkit-transform: rotate(0deg) skewY(0deg);
            }
            20% {
              -webkit-transform: rotate(12deg) skewY(4deg);
            }
            60% {
              -webkit-transform: rotate(-9deg) skewY(-3deg);
            }
            80% {
              -webkit-transform: rotate(6deg) skewY(-2deg);
            }
            100% {
              -webkit-transform: rotate(0deg) skewY(0deg);
            }
          }

          @keyframes swing {
            0% {
              transform: rotate(0deg) skewY(0deg);
            }
            20% {
              transform: rotate(12deg) skewY(4deg);
            }
            60% {
              transform: rotate(-9deg) skewY(-3deg);
            }
            80% {
              transform: rotate(6deg) skewY(-2deg);
            }
            100% {
              transform: rotate(0deg) skewY(0deg);
            }
          }
        `;

        function Calendar(props) {
          return (
            <CalendarStyled>
              <time className="icon">
                <em>{props.dow}</em>
                <strong>{props.month}</strong>
                <span>{props.day}</span>
              </time>
            </CalendarStyled>
          );
        }

        class MarketShareByYearExch extends Component {
          constructor(props, context) {
            super(props, context);
            autoBind(this);
          }

          createChart(props) {
            this.chart = echarts.init(ReactDOM.findDOMNode(this), "macarons");
            if (!props) {
              return null;
            }
            const options = this.makeChartOptions(props);
            this.chart.setOption(options);
          }

          makeChartOptions(props) {
            const { legendData, xAxisData, series } = props.data;
            const style = "display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px";
            const colorSpan = color => `<span style="${style};background-color:${color}"></span>`;

            return {
              tooltip: {
                trigger: "axis",
                axisPointer: {
                  animation: true,
                },
                formatter: function(params) {
                  let rez = `<p style="text-align:left"><b>Year ${params[0].axisValue}</b></p>`;
                  rez += "<table>";
                  params.forEach(item => {
                    const colorEle = colorSpan(item.color);
                    const pct = numeral(item.data).format("0.00%");
                    const xx = `<tr><td style="text-align:left">${colorEle} ${item.seriesName}</td><td style="text-align:right;padding-left:5px">${pct}</td></tr>`;
                    rez += xx;
                  });
                  rez += "</table>";
                  return rez;
                },
              },
              legend: {
                bottom: 0,
                left: "center",
                itemWidth: 20,
                padding: [60, 80, 0, 80],
                data: legendData,
              },
              toolbox: {
                show: true,
                feature: {
                  magicType: {
                    show: true,
                    type: ["line", "bar", "stack", "tiled"],
                    title: {
                      line: "Line Chart",
                      bar: "Bar Chart",
                      stack: "Stacked",
                      tiled: "Tiled",
                    },
                  },
                  restore: { show: true, title: "Restore" },
                  saveAsImage: {
                    show: true,
                    title: "Save As Image",
                    type: "png",
                    name: "market-share-by-year-exchange",
                  },
                },
                orient: "vertical",
                iconStyle: {
                  normal: {
                    textPosition: "left",
                    textAlign: "right",
                  },
                  emphasis: {
                    textPosition: "left",
                    textAlign: "right",
                  },
                },
                top: "middle",
              },
              calculable: true,
              xAxis: {
                type: "category",
                boundaryGap: true,
                data: xAxisData,
              },
              yAxis: {
                type: "value",
                max: "dataMax",
                axisLabel: {
                  formatter: function(value, index) {
                    return numeral(value).format("0%");
                  },
                },
              },
              series,
            };
          }

          resizeContainer() {
            const node = ReactDOM.findDOMNode(this);
            const { height } = node.getBoundingClientRect();
            node.style.height = height;
            this.props.onResize(height);
          }

          componentDidMount() {
            echarts.registerTheme("macarons", macarons);
            this.resizeContainer();
            this.createChart(this.props);
            window.onresize = () => {
              this.resizeContainer();
              this.chart.resize();
            };
            setTimeout(function(){
              this.resizeContainer();
            }.bind(this), 500);
          }

          componentWillUnmount() {
            this.chart.dispose();
          }

          shouldComponentUpdate(nextProps, nextState) {
            return false;
          }

          componentWillReceiveProps(nextProps) {
            if (!_.isEqual(nextProps.data, this.props.data)) {
              this.chart.dispose();
              this.createChart(nextProps);
            }
          }

          render() {
            return <div style={{ height: "70vh", width: "100%"}} />;
           }
        }

        class MarketShareByYearExchWithData extends Component {
          constructor(props, context) {
            super(props, context);
            autoBind(this);
            this.exchangeGroups = this.getExchangeGroups();
            this.state = { groupName: "all", chartData: this.filterData("all"), height: 300 };
          }

          isInGroup(exch, groupName) {
            if (groupName === "all") return true;
            const groupMembers = this.exchangeGroups[groupName].venues;
            return groupMembers.includes(exch);
          }

          getExchangeGroups() {
            return {
              all: {
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Icon component={() => <img src="https://upload.wikimedia.org/wikipedia/en/a/a4/Flag_of_the_United_States.svg" style={{width: 75, height: 40, marginBottom: 20, marginRight: 10}} />}/>
                      <h5>Market Share</h5>
                      <font size={4}>
                        <ul className="comment-item">
                          <li>NASDAQ's market share started to pick up over the last four years.</li>
                          <li>NYSE's market share also observed a moderate increase in the recent three years.</li>
                          <li>Cboe is losing its market share year by year.</li>
                          <li>Inverted venues lost its momentum and started to turn down.</li>
                          <li>IEX momentum is still strong since its debut in 2013.</li>
                          <li>Off-market trading maintains its position steadily.</li>
                        </ul>
                      </font>
                    </Row>
                  </div>
                )
              },
              cboe: {
                venues: ["CBOE", "CBOE BYX", "CBOE BZX", "CBOE EDGA", "CBOE EDGX"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Icon component={() => <img src="https://upload.wikimedia.org/wikipedia/commons/8/8a/Cboe_Global_Markets_Logo.svg" style={{width: 117.5, height: 40, marginBottom: 20}} />}/>
                      <font size={4}>
                        Cboe intends to expand its equities business by acquiring BATS in 2017:
                        <ul className="comment-item">
                          <li>Cboe's market share has been decreasing since it announced to acquire BATS in September 2016.</li>
                          <li>Cboe's market share peaked at 22% in 2012, but it dropped to 16.2% in 2019.</li>
                        </ul>
                      </font>
                    </Row>
                  </div>
                )
              },
              nasdaq: {
                venues: ["NASDAQ", "NASDAQ BX", "NASDAQ ISE", "NASDAQ PSX"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Icon component={() => <img src="https://new.nasdaq.com/themes/nsdq/dist/assets/images/logo.svg" style={{width: 147, height: 42, marginBottom:20}} />}/>
                      <font size={4}>
                        <ul className="comment-item">
                          <li>NASDAQ keeps losing market share since 2008 and reaches its lowest at 17.4% in 2016.</li>
                          <li>NASDAQ starts to gain more market share since 2017, epecially in the traditional NASDAQ market.</li>
                          <li>NASDAQ Boston, an inverted venue, keeps losing market share. It drops from 3.1% in 2017 to less than 2% in 2019.</li>
                        </ul>
                      </font>
                    </Row>
                  </div>
                ),
              },
              nyse: {
                venues: ["NYSE", "NYSE American", "NYSE Arca", "NYSE Chicago", "NYSE National"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Icon component={() => <img src="https://upload.wikimedia.org/wikipedia/commons/9/93/NY_Stock_Exchange_logo.svg" style={{width: 40, height: 40, marginBottom: 20}} />}/>
                      <font size={4}>
                        <ul className="comment-item">
                          <li>NYSE's market share is very stable in recent years.</li>
                          <li>NYSE National, an inverted venue, adds 1.2% of market share to NYSE in 2019.</li>
                          <li>NYSE Arca keeps losing market share in the last 10 years.</li>
                          <li>NYSE American's market share never exceeds 0.5% in the last 10 years.</li>
                        </ul>
                      </font>
                    </Row>
                  </div>
                )
              },
              inverted: {
                venues: ["CBOE BYX", "CBOE EDGA", "NASDAQ BX", "NYSE National"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <h5>Inverted Venues</h5>
                      <font size={4}>
                        The inverted venues charge a fee for providing liquidity, but provide a rebate to liquidity takers:
                        <ul className="comment-item">
                          <li>The market share of inverted venues has been increasing steadily since 2013 and reaches the peak at 9.8% in 2017.</li>
                          <li>Inverted venues' market share decreased over the last three years.</li>
                          <li>NYSE National became an inverted venue on May 20, 2018.</li>
                        </ul>
                      </font>
                    </Row>
                  </div>
                )
              },
              iex: {
                venues: ["IEX"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Icon component={() => <img src="https://upload.wikimedia.org/wikipedia/commons/5/5d/IEX_Group_Logo.svg" style={{width: 61.5, height: 40, marginBottom: 20}} />}/>
                      <font size={4}>
                        The Investors Exchange (IEX) the newest exchange in the US equities markets:
                        <ul className="comment-item">
                          <li>It became an exchange in September 2016 and it was operated as an ATS before that.</li>
                          <li>Its market share is abount 1.5% as a dark pool it became an exchange.</li>
                          <li>Its market share jumped from 1.5% to 2.2% after becoming an exchange.</li>
                          <li>After that, IEX's market share increased by roughly 10% each year.</li>
                        </ul>
                      </font>
                    </Row>
                  </div>
                )
              },
              trf: {
                venues: ["TRF"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Icon component={() => <img src="https://upload.wikimedia.org/wikipedia/en/1/17/Financial_Industry_Regulatory_Authority_logo.svg" style={{width: 150.5, height: 40, marginBottom: 20}} />}/>
                      <font size={4}>
                        The off-market volume is transacted outside of regular stock exchanges and reported to FINRA via TRF (Trade Reporting Facility):
                        <ul className="comment-item">
                          <li>The off-market volume includes trades from OTC (Over-The-Counter) and ATS (Alternative Trading System)</li>
                          <li>It accounts for around 36%-37% over the last five years. Its market share is fairely stable.</li>
                        </ul>
                      </font>
                    </Row>
                  </div>
                )
              },
            };
          }

          onGroupSelection(e) {
            const groupName = e.target.value;
            this.setState({ groupName, chartData: this.filterData(groupName) });
          }

          filterData(groupName) {
            const chartData = { xAxisData: marketShareByYearExch.year, legendData: [], series: [] };
            Object.keys(marketShareByYearExch).forEach(key => {
              if (key === "year") return;
              const name = key;
              if (this.isInGroup(name, groupName)) {
                const dataPoints = {
                  name,
                  type: "bar",
                  barMaxWidth: 50,
                  stack: "mktShare",
                  itemStyle: { normal: { areaStyle: { type: "default" } } },
                  data: marketShareByYearExch[name],
                };
                if (groupName === "inverted" && name === "NYSE National") {
                  marketShareByYearExch.year.forEach(function(year, i) {
                    if (year <= 2017) {
                      dataPoints.data[i] = 0;
                    }
                  });
                }
                chartData.legendData.push(name);
                chartData.series.push(dataPoints);
              }
            });
            return chartData;
          }

          onResize(height) {
            this.setState({height});
          }

          render() {
            const { groupName, chartData, height } = this.state;
            const commentContent = this.exchangeGroups[groupName].content;

            return (
              <Fragment>
                <Row gutter={32}>
                  <Col span={16}>
                    <div align="right">
                      <Radio.Group onChange={this.onGroupSelection} value={groupName}>
                        <Radio value="all">All</Radio>
                        <Radio value="cboe">CBOE</Radio>
                        <Radio value="nasdaq">NASDAQ</Radio>
                        <Radio value="nyse">NYSE</Radio>
                        <Radio value="inverted">Inverted</Radio>
                        <Radio value="iex">IEX</Radio>
                        <Radio value="trf">Off-Market</Radio>
                      </Radio.Group>
                    </div>
                  </Col>
                </Row>

                <Row gutter={32}>
                  <Col span={16}>
                    <MarketShareByYearExch data={chartData} onResize={this.onResize} />
                  </Col>
                  <Col span={8}>
                    <Row className="comments" gutter={8}>
                      <Col span={20}>
                        <div className="comments-content" style={{height: Math.max(400, height - 100)}}>{commentContent}</div>
                      </Col>
                    </Row>
                  </Col>
                </Row>
              </Fragment>
            );
          }
        }

        class ChartComponent extends Component {
          constructor(props, context) {
            super(props, context);
            autoBind(this);
          }

          createChart(props) {
            this.chart = echarts.init(ReactDOM.findDOMNode(this), "macarons");
            if (!props.data) {
              return null;
            }
            const options = this.makeChartOptions(props);
            this.chart.setOption(options);
          }

          resizeContainer() {
            const node = ReactDOM.findDOMNode(this);
            const { height } = node.getBoundingClientRect();
            node.style.height = height;
            this.props.onResize(height);
          }

          componentDidMount() {
            echarts.registerTheme("macarons", macarons);
            this.resizeContainer();
            this.createChart(this.props);
            window.onresize = () => {
              this.resizeContainer();
              this.chart.resize();
            };
            setTimeout(
              function() {
                this.resizeContainer();
              }.bind(this),
              500
            );
          }

          componentWillUnmount() {
            this.chart.dispose();
          }

          shouldComponentUpdate(nextProps, nextState) {
            return false;
          }

          componentWillReceiveProps(nextProps) {
            if (!_.isEqual(nextProps.data, this.props.data) && !!nextProps.data) {
              this.chart.dispose();
              this.createChart(nextProps);
            }
          }

          render() {
            return <div style={{ height: "70vh", width: "100%" }} />;
          }
        }

        class MarketShareByYearTapeAC extends ChartComponent {
          constructor(props, context) {
            super(props, context);
          }

          makeChartOptions(props) {
            const { legendData, xAxisData, series } = props.data;
            const style = "display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px";
            const colorSpan = color => `<span style="${style};background-color:${color}"></span>`;

            return {
              title: {
                left: "center",
                text: "NASDAQ on Tape A vs NYSE on Tape C",
              },
              xAxis: {
                type: 'category',
                boundaryGap: true,
                offset: 10,
                name: 'Month',
                nameLocation: 'end',
                nameGap: 5,
                data: xAxisData
              },
              yAxis: {
                type: 'value',
                min: "dataMin",
                max: "dataMax",
                scale: true,
                name: 'Market Share',
                nameLocation: 'end',
                nameGap: 20,
                axisLabel: {
                  formatter: function(value, index) {
                    return numeral(value).format("0.0%");
                  },
                },
              },
              legend: {
                bottom: 0,
                left: "center",
                itemWidth: 20,
                padding: [60, 80, 0, 80],
                data: legendData,
              },
              tooltip: {
                trigger: "axis",
                axisPointer: {
                  animation: true,
                },
                formatter: function(params) {
                  let rez = `<p style="text-align:left"><b>Month ${params[0].axisValue}</b></p>`;
                  rez += "<table>";
                  params.forEach(item => {
                    const colorEle = colorSpan(item.color);
                    const pct = numeral(item.data).format("0.00%");
                    const xx = `<tr><td style="text-align:left">${colorEle} ${item.seriesName}</td><td style="text-align:right;padding-left:5px">${pct}</td></tr>`;
                    rez += xx;
                  });
                  rez += "</table>";
                  return rez;
                },
              },
              toolbox: {
                show: true,
                feature: {
                  magicType: {
                    show: true,
                    type: ["line", "bar"],
                    title: {
                      line: "Line Chart",
                      bar: "Bar Chart",
                    },
                  },
                  restore: { show: true, title: "Restore" },
                  saveAsImage: {
                    show: true,
                    title: "Save As Image",
                    type: "png",
                    name: "market-share-TapeCbyNYSE-tapeAbyNASDAQ",
                  },
                },
                orient: "vertical",
                iconStyle: {
                  normal: {
                    textPosition: "left",
                    textAlign: "right",
                  },
                  emphasis: {
                    textPosition: "left",
                    textAlign: "right",
                  },
                },
                top: "middle",
              },
              calculable: true,
              series
            };
          }
        }

        class MarketShareByYearTapeACWithData extends Component {
          constructor(props, context) {
            super(props, context);
            autoBind(this);
            this.state = { chartData: this.filterData(), height: 300 };
          }

          filterData() {
            const chartData = { xAxisData: marketShareTapeAC.month, legendData: [], series: [] };
            Object.keys(marketShareTapeAC).forEach(key => {
              if (key === "month") return;
              const name = key === "nasdaqMarketShareInTapeA" ? "Tape A Traded by NASDAQ" : "Tape C Traded by NYSE";
              const dataPoints = {
                name,
                type: "line",
                barMaxWidth: 50,
                lineStyle: {type: key === "nasdaqMarketShareInTapeA" ? "solid" : "dotted"},
                data: marketShareTapeAC[key],
              };
              chartData.legendData.push(name);
              chartData.series.push(dataPoints);
            });
            return chartData;
          }

          onResize(height) {
            this.setState({height});
          }

          getCommentContent() {
            return (
              <div>
                <Row type="flex" justify="space-around" align="middle">
                  <Col><Calendar month="April" day={9} dow="2018" style={{ width: 60, height: 60 }} /></Col>
                </Row>

                <Row type="flex" justify="start" style={{ marginTop: 30 }}>
                  <font size={4}>
                    Under UTP, NYSE-listed stocks can be traded on NASDAQ, but NASDAQ-listed stocks cannot be trade on NYSE.
                    <ul className="comment-item">
                      <li>NYSE's market share in NASDAQ-listed stocks increase gradually, but has been stagnant around 1.8% for quite a few months.</li>
                      <li>NASDAQ has been gaining market shares in NYSE-listed stocks since Apr 2018, <i>i.e.</i> increasing from 9.8% to 13.4%.</li>
                    </ul>
                  </font>
                </Row>
              </div>
            );
          }

          render() {
            const { chartData, height } = this.state;
            const commentContent = this.getCommentContent();

            return (
              <Fragment>
                <Row gutter={32}>
                  <Col span={16}>
                    <MarketShareByYearTapeAC data={chartData} onResize={this.onResize} />
                  </Col>
                  <Col span={8}>
                    <Row className="comments" gutter={8}>
                      <Col span={20}>
                        <div className="comments-content" style={{height: Math.max(400, height - 100)}}>{commentContent}</div>
                      </Col>
                    </Row>
                  </Col>
                </Row>
              </Fragment>
            );
          }
        }

        // Customize the default theme
        const { themes: { defaultTheme } } = Spectacle;
        const theme = defaultTheme({
          primary: 'white',
          secondary: 'black',
          tertiary: 'blue',
          quaternary: 'black'
        });

        return (
          <Deck transition={["zoom", "slide"]} theme={theme} transitionDuration={500} contentWidth={"90%"} contentHeight={"100%"}>
            <SlideSet style={{ border: '1px solid red' }}>
              <Slide bgColor="primary">
                <Heading transition={["slide"]} size={1} caps lineHeight={1} textColor="secondary" margin="0px 0px 50px 0px">
                  U.S. Equities Market
                </Heading>
                <Heading size={3} caps textColor="tertiary" margin="0px 0px 50px 0px">
                    Year In Review: 2019
                </Heading>
                <Text textSize="1.5em" margin="0px 0px 50px 0px" bold textColor="black">
                  Presented by
                </Text>
                <Text textSize="1.0em" margin="0px 0px 30px 0px" bold textColor="blue">
                  David Han
                </Text>
              </Slide>

              <Slide transition={["zoom", "fade"]} bgColor="primary">
                <Text textSize="1.5em" margin="0px 0px 30px 0px" bold textColor="black">
                  U.S. Equities Market Share
                </Text>
                <MarketShareByYearExchWithData />
              </Slide>

              <Slide transition={["zoom", "fade"]} bgColor="primary">
                <Text textSize="1.5em" margin="0px 0px 30px 0px" bold textColor="black">
                  UTP: NYSE vs NASDAQ
                </Text>
                <MarketShareByYearTapeACWithData />
              </Slide>

            </SlideSet>
          </Deck>
        );
      }
    </script>
  </body>
</html>
