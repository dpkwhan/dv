<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <title>Year In Review: 2019</title>
    <link href="https://fonts.googleapis.com/css?family=Lobster+Two:400,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/normalize.css@7/normalize.css" rel="stylesheet" type="text/css" />
    <link href="https://unpkg.com/antd@3.22.0/dist/antd.css" rel="stylesheet" type="text/css" />
    <style>
      html body * {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
          "Helvetica Neue", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      }

      .comments {
        margin-top: 50px;
      }

      .comments-content {
        margin-top: 0px;
        border: 1px dashed #e9e9e9;
        border-radius: 6px;
        background-color: #fafafa;
        text-align: left;
        padding-top: 10px;
        padding-left: 10px;
        height: "50vh";
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- react -->
    <script src="https://unpkg.com/prop-types@15/prop-types.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>

    <!-- spectacle -->
    <script src="https://unpkg.com/@babel/standalone/babel.js"></script>
    <script src="https://unpkg.com/spectacle@^5/dist/spectacle.js"></script>
    <script src="https://unpkg.com/spectacle@^5/lib/one-page.js"></script>

    <!-- echarts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/4.2.1/echarts.min.js"></script>

    <!-- numeral -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>

    <!-- ant design -->
    <script src="https://unpkg.com/moment/min/moment-with-locales.js"></script>
    <script src="https://unpkg.com/antd@3.22.0/dist/antd-with-locales.min.js"></script>

    <!-- lodash -->
    <script src="https://unpkg.com/lodash@4.17.15/lodash.js"></script>

    <script type="text/spectacle">
      () => {

        var wontBind = ['constructor', 'render', 'componentWillMount',
          'componentDidMount', 'componentWillReceiveProps',
          'shouldComponentUpdate', 'componentWillUpdate',
          'componentDidUpdate', 'componentWillUnmount'
        ];
        var toBind = [];

        function autoBind(context) {
          if (context === undefined) {
            console.error('Autobind error: No context provided.');
            return;
          }

          var objPrototype = Object.getPrototypeOf(context);

          if (arguments.length > 1) {
            // If a list of methods to bind is provided, use it.
            toBind = Array.prototype.slice.call(arguments, 1);
          } else {
            // If no list of methods to bind is provided, bind all available methods in class.
            toBind = Object.getOwnPropertyNames(objPrototype);
          }

          toBind.forEach(function (method) {
            var descriptor = Object.getOwnPropertyDescriptor(objPrototype, method);

            if (descriptor === undefined) {
              console.warn('Autobind: "' + method + '" method not found in class.');
              return;
            }

            // Return if it's special case function or if not a function at all
            if (wontBind.indexOf(method) !== -1 || typeof descriptor.value !== 'function') {
              return;
            }

            Object.defineProperty(objPrototype, method, boundMethod(objPrototype, method, descriptor));
          });
        }

        function boundMethod(objPrototype, method, descriptor) {
          var fn = descriptor.value;

          return {
            configurable: true,
            get: function get() {
              if (this === objPrototype || this.hasOwnProperty(method)) {
                return fn;
              }

              var boundFn = fn.bind(this);
              Object.defineProperty(this, method, {
                value: boundFn,
                configurable: true,
                writable: true
              });
              return boundFn;
            }
          };
        }

        // ECharts theme
        const macarons = {
          color: [
            "#2ec7c9",
            "#b6a2de",
            "#5ab1ef",
            "#ffb980",
            "#d87a80",
            "#8d98b3",
            "#e5cf0d",
            "#97b552",
            "#95706d",
            "#dc69aa",
            "#07a2a4",
            "#9a7fd1",
            "#588dd5",
            "#f5994e",
            "#c05050",
            "#59678c",
            "#c9ab00",
            "#7eb00a",
            "#6f5553",
            "#c14089",
          ],

          title: {
            textStyle: {
              fontWeight: "normal",
              color: "#008acd",
            },
          },

          dataRange: {
            itemWidth: 15,
            color: ["#5ab1ef", "#e0ffff"],
          },

          toolbox: {
            color: ["#1e90ff", "#1e90ff", "#1e90ff", "#1e90ff"],
            effectiveColor: "#ff4500",
          },

          tooltip: {
            backgroundColor: "rgba(50,50,50,0.5)",
            axisPointer: {
              type: "line",
              lineStyle: {
                color: "#008acd",
              },
              crossStyle: {
                color: "#008acd",
              },
              shadowStyle: {
                color: "rgba(200,200,200,0.2)",
              },
            },
          },

          dataZoom: {
            dataBackgroundColor: "#efefff",
            fillerColor: "rgba(182,162,222,0.2)",
            handleColor: "#008acd",
          },

          grid: {
            borderColor: "#eee",
          },

          categoryAxis: {
            axisLine: {
              lineStyle: {
                color: "#008acd",
              },
            },
            splitLine: {
              lineStyle: {
                color: ["#eee"],
              },
            },
          },

          valueAxis: {
            axisLine: {
              lineStyle: {
                color: "#008acd",
              },
            },
            splitArea: {
              show: true,
              areaStyle: {
                color: ["rgba(250,250,250,0.1)", "rgba(200,200,200,0.1)"],
              },
            },
            splitLine: {
              lineStyle: {
                color: ["#eee"],
              },
            },
          },

          polar: {
            axisLine: {
              lineStyle: {
                color: "#ddd",
              },
            },
            splitArea: {
              show: true,
              areaStyle: {
                color: ["rgba(250,250,250,0.2)", "rgba(200,200,200,0.2)"],
              },
            },
            splitLine: {
              lineStyle: {
                color: "#ddd",
              },
            },
          },

          timeline: {
            lineStyle: {
              color: "#008acd",
            },
            controlStyle: {
              normal: { color: "#008acd" },
              emphasis: { color: "#008acd" },
            },
            symbol: "emptyCircle",
            symbolSize: 3,
          },

          bar: {
            itemStyle: {
              barBorderRadius: 5,
            },
          },

          line: {
            smooth: true,
            symbol: "emptyCircle",
            symbolSize: 3,
          },

          k: {
            itemStyle: {
              normal: {
                color: "#d87a80",
                color0: "#2ec7c9",
                lineStyle: {
                  color: "#d87a80",
                  color0: "#2ec7c9",
                },
              },
            },
          },

          scatter: {
            symbol: "circle",
            symbolSize: 4,
          },

          radar: {
            symbol: "emptyCircle",
            symbolSize: 3,
            //symbol: null,
            //symbolRotate : null,
          },

          map: {
            itemStyle: {
              normal: {
                areaStyle: {
                  color: "#ddd",
                },
                label: {
                  textStyle: {
                    color: "#d87a80",
                  },
                },
              },
              emphasis: {
                areaStyle: {
                  color: "#fe994e",
                },
              },
            },
          },

          force: {
            itemStyle: {
              normal: {
                linkStyle: {
                  color: "#1e90ff",
                },
              },
            },
          },

          chord: {
            itemStyle: {
              normal: {
                borderWidth: 1,
                borderColor: "rgba(128, 128, 128, 0.5)",
                chordStyle: {
                  lineStyle: {
                    color: "rgba(128, 128, 128, 0.5)",
                  },
                },
              },
              emphasis: {
                borderWidth: 1,
                borderColor: "rgba(128, 128, 128, 0.5)",
                chordStyle: {
                  lineStyle: {
                    color: "rgba(128, 128, 128, 0.5)",
                  },
                },
              },
            },
          },

          gauge: {
            axisLine: {
              lineStyle: {
                color: [[0.2, "#2ec7c9"], [0.8, "#5ab1ef"], [1, "#d87a80"]],
                width: 10,
              },
            },
            axisTick: {
              splitNumber: 10,
              length: 15,
              lineStyle: {
                color: "auto",
              },
            },
            splitLine: {
              length: 22,
              lineStyle: {
                color: "auto",
              },
            },
            pointer: {
              width: 5,
            },
          },

          textStyle: {
            fontFamily: "Arial, Verdana, sans-serif",
          },
        };

        const { Button, Row, Col, Radio, Steps, Divider, Input } = antd;
        const Step = Steps.Step;
        const TextArea = Input.TextArea;
        const { Component, Fragment } = React;
        const { Heading } = Spectacle;

        // JSON data
        const jStrMarketShareByYearExch = `{"year":[2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019],"CBOE":[0.001553126,0.001517211,0.002513032,0.001154305,0.003647843,0.004147346,0.0008273976,0,0,0,0,0],"CBOE BYX":[0,0,0.001711023,0.02233438,0.0300008,0.01965342,0.03082055,0.04085694,0.04337259,0.04873961,0.04718219,0.04041712],"CBOE BZX":[0.01712512,0.1022285,0.1006168,0.09076816,0.08849648,0.08392778,0.07803235,0.07132131,0.06491506,0.05971903,0.06462826,0.05504694],"CBOE EDGA":[0,0,0.01792306,0.03571367,0.02584397,0.02998067,0.02694379,0.02663557,0.02571326,0.01798313,0.01366565,0.02165629],"CBOE EDGX":[0,0,0.01933663,0.05888192,0.06744347,0.0762213,0.06787677,0.07230856,0.07239488,0.06396302,0.05832063,0.04473561],"IEX":[0,0,0,0,0,0,0,0,0.005370828,0.02203966,0.02449299,0.02739987],"NASDAQ":[0.2994096,0.213259,0.1878663,0.180777,0.1703731,0.1562811,0.1710157,0.1587936,0.1399825,0.1416641,0.1589994,0.1735855],"NASDAQ BX":[0,0.01697694,0.03337244,0.02149014,0.02638685,0.02462354,0.02500902,0.01971339,0.02374147,0.03118962,0.02848183,0.01955371],"NASDAQ ISE":[0.01101148,0.0188405,0.008313444,0,0,0,0,0,0,0,0,0],"NASDAQ PSX":[0.0005673296,0,0.001162175,0.01019435,0.01086213,0.006940611,0.005658153,0.009635768,0.009957686,0.007769261,0.007597216,0.007304567],"NYSE":[0.1684241,0.1407456,0.1354423,0.1322114,0.1180604,0.1163867,0.1139094,0.1268429,0.1329333,0.1311558,0.1280733,0.1334676],"NYSE American":[0.004202999,0.001779399,0.002544374,0.003592237,0.00228655,0.002912972,0.003315428,0.002375266,0.002123802,0.002517418,0.003397272,0.00353351],"NYSE Arca":[0.1799778,0.1530225,0.1390412,0.131038,0.1196199,0.105742,0.1074679,0.1115833,0.1073326,0.09304159,0.09190951,0.08618862],"NYSE Chicago":[0.004294733,0.003916805,0.004019295,0.003377,0.004028267,0.004353622,0.004475207,0.005400293,0.004398395,0.004575037,0.005213556,0.004594182],"NYSE National":[0.01515979,0.0067369,0.006385692,0.005635292,0.003687354,0.00443541,0.001411458,5.160788e-008,9.235677e-005,1.3421e-005,0.004686542,0.0116567],"TRF":[0.298274,0.3409766,0.3397522,0.3028321,0.3292628,0.3643935,0.3632369,0.3545331,0.3676712,0.3756293,0.3633517,0.3708598]}`;
        const marketShareByYearExch = JSON.parse(jStrMarketShareByYearExch);

        // Customize the default theme
        const { themes: { defaultTheme } } = Spectacle;
        const theme = defaultTheme({
          primary: 'white',
          secondary: 'black',
          tertiary: 'blue',
          quaternary: 'black'
        });

        class MarketShareByYearExch extends Component {
          constructor(props, context) {
            super(props, context);
            autoBind(this);
          }

          createChart(props) {
            this.chart = echarts.init(ReactDOM.findDOMNode(this), "macarons");
            if (!props) {
              return null;
            }
            const options = this.makeChartOptions(props);
            this.chart.setOption(options);
          }

          makeChartOptions(props) {
            const { legendData, xAxisData, series } = props.data;
            const style = "display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px";
            const colorSpan = color => `<span style="${style};background-color:${color}"></span>`;

            return {
              tooltip: {
                trigger: "axis",
                axisPointer: {
                  animation: true,
                },
                formatter: function(params) {
                  let rez = `<p style="text-align:left"><b>Year ${params[0].axisValue}</b></p>`;
                  rez += "<table>";
                  params.forEach(item => {
                    const colorEle = colorSpan(item.color);
                    const pct = numeral(item.data).format("0.00%");
                    const xx = `<tr><td style="text-align:left">${colorEle} ${item.seriesName}</td><td style="text-align:right;padding-left:5px">${pct}</td></tr>`;
                    rez += xx;
                  });
                  rez += "</table>";
                  return rez;
                },
              },
              legend: {
                bottom: 0,
                left: "center",
                itemWidth: 20,
                padding: [60, 80, 0, 80],
                data: legendData,
              },
              toolbox: {
                show: true,
                feature: {
                  magicType: {
                    show: true,
                    type: ["line", "bar", "stack", "tiled"],
                    title: {
                      line: "Line Chart",
                      bar: "Bar Chart",
                      stack: "Stacked",
                      tiled: "Tiled",
                    },
                  },
                  restore: { show: true, title: "Restore" },
                  saveAsImage: {
                    show: true,
                    title: "Save As Image",
                    type: "png",
                    name: "market-share-by-year-exchange",
                  },
                },
                orient: "vertical",
                iconStyle: {
                  normal: {
                    textPosition: "left",
                    textAlign: "right",
                  },
                  emphasis: {
                    textPosition: "left",
                    textAlign: "right",
                  },
                },
                top: "middle",
              },
              calculable: true,
              xAxis: [
                {
                  type: "category",
                  boundaryGap: true,
                  data: xAxisData,
                },
              ],
              yAxis: [
                {
                  type: "value",
                  max: "dataMax",
                  axisLabel: {
                    formatter: function(value, index) {
                      return numeral(value).format("0%");
                    },
                  },
                },
              ],
              series,
            };
          }

          resizeContainer() {
            const node = ReactDOM.findDOMNode(this);
            const { height } = node.getBoundingClientRect();
            node.style.height = height;
            this.props.onResize(height);
          }

          componentDidMount() {
            echarts.registerTheme("macarons", macarons);
            this.resizeContainer();
            this.createChart(this.props);
            window.onresize = () => {
              this.resizeContainer();
              this.chart.resize();
            };
            setTimeout(function(){
              this.resizeContainer();
            }.bind(this), 500);
          }

          componentWillUnmount() {
            this.chart.dispose();
          }

          shouldComponentUpdate(nextProps, nextState) {
            return false;
          }

          componentWillReceiveProps(nextProps) {
            if (!_.isEqual(nextProps.data, this.props.data)) {
              this.chart.dispose();
              this.createChart(nextProps);
            }
          }

          render() {
            return <div style={{ height: "70vh", width: "100%"}} className="chart" />;
           }
        }

        class MarketShareByYearExchWithData extends Component {
          constructor(props, context) {
            super(props, context);
            autoBind(this);
            this.exchangeGroups = this.getExchangeGroups();
            this.state = { groupName: "cboe", chartData: this.filterData("cboe"), height: 300 };
          }

          isInGroup(exch, groupName) {
            if (groupName === "all") return true;
            const groupMembers = this.exchangeGroups[groupName].venues;
            return groupMembers.includes(exch);
          }

          getExchangeGroups() {
            return {
              all: {
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Divider orientation="left"><h2>Overall Market Share</h2></Divider>
                      <font size={4}>
                        Cboe introduces a closing match process for non-BZX listed
                        securities. Cboe seeks to match buy and sell MOC orders at the official
                        primary closing price
                      </font>
                    </Row>
                  </div>
                )
              },
              cboe: {
                venues: ["CBOE", "CBOE BYX", "CBOE BZX", "CBOE EDGA", "CBOE EDGX"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Divider orientation="left"><h2>CBOE</h2></Divider>
                      <font size={4}>
                        Cboe introduces a closing match process for non-BZX listed
                        securities. Cboe seeks to match buy and sell MOC orders at the official
                        primary closing price
                      </font>
                    </Row>
                  </div>
                )
              },
              nasdaq: {
                venues: ["NASDAQ", "NASDAQ BX", "NASDAQ ISE", "NASDAQ PSX"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Divider orientation="left"><h2>NASDAQ</h2></Divider>
                      <font size={4}>
                        Cboe introduces a closing match process for non-BZX listed
                        securities. Cboe seeks to match buy and sell MOC orders at the official
                        primary closing price
                      </font>
                    </Row>
                  </div>
                ),
              },
              nyse: {
                venues: ["NYSE", "NYSE American", "NYSE Arca", "NYSE Chicago", "NYSE National"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Divider orientation="left"><h2>NYSE</h2></Divider>
                      <font size={4}>
                        Cboe introduces a closing match process for non-BZX listed
                        securities. Cboe seeks to match buy and sell MOC orders at the official
                        primary closing price
                      </font>
                    </Row>
                  </div>
                )
              },
              inverted: {
                venues: ["CBOE BYX", "CBOE EDGA", "NASDAQ BX", "NYSE National"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Divider orientation="left"><h2>Inverted Venues</h2></Divider>
                      <font size={4}>
                        Cboe introduces a closing match process for non-BZX listed
                        securities. Cboe seeks to match buy and sell MOC orders at the official
                        primary closing price
                      </font>
                    </Row>
                  </div>
                )
              },
              iex: {
                venues: ["IEX"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Divider orientation="left"><h2>IEX</h2></Divider>
                      <font size={4}>
                        Cboe introduces a closing match process for non-BZX listed
                        securities. Cboe seeks to match buy and sell MOC orders at the official
                        primary closing price
                      </font>
                    </Row>
                  </div>
                )
              },
              trf: {
                venues: ["TRF"],
                content: (
                  <div>
                    <Row type="flex" justify="start">
                      <Divider orientation="left"><h2>Off-Market</h2></Divider>
                      <font size={4}>
                        Cboe introduces a closing match process for non-BZX listed
                        securities. Cboe seeks to match buy and sell MOC orders at the official
                        primary closing price
                      </font>
                    </Row>
                  </div>
                )
              },
            };
          }

          onGroupSelection(e) {
            const groupName = e.target.value;
            this.setState({ groupName, chartData: this.filterData(groupName) });
          }

          filterData(groupName) {
            const chartData = { xAxisData: marketShareByYearExch.year, legendData: [], series: [] };
            Object.keys(marketShareByYearExch).forEach(key => {
              if (key === "year") return;
              const name = key;
              if (this.isInGroup(name, groupName)) {
                const dataPoints = {
                  name,
                  type: "bar",
                  barMaxWidth: 50,
                  stack: "mktShare",
                  itemStyle: { normal: { areaStyle: { type: "default" } } },
                  data: marketShareByYearExch[name],
                };
                chartData.legendData.push(name);
                chartData.series.push(dataPoints);
              }
            });
            return chartData;
          }

          onResize(height) {
            this.setState({height});
          }

          render() {
            const { groupName, chartData, height } = this.state;
            const commentContent = this.exchangeGroups[groupName].content;

            return (
              <Fragment>
                <Row gutter={32}>
                  <Col span={16}>
                    <div align="right">
                      <Radio.Group onChange={this.onGroupSelection} value={groupName}>
                        <Radio value="all">All</Radio>
                        <Radio value="cboe">CBOE</Radio>
                        <Radio value="nasdaq">NASDAQ</Radio>
                        <Radio value="nyse">NYSE</Radio>
                        <Radio value="inverted">Inverted</Radio>
                        <Radio value="iex">IEX</Radio>
                        <Radio value="trf">Off-Market</Radio>
                      </Radio.Group>
                    </div>
                  </Col>
                </Row>

                <Row gutter={32}>
                  <Col span={16}>
                    <MarketShareByYearExch data={chartData} onResize={this.onResize} />
                  </Col>
                  <Col span={8}>
                    <Row className="comments" gutter={8}>
                      <Col span={20}>
                        <div className="comments-content" style={{height: Math.max(400, height - 100)}}>{commentContent}</div>
                      </Col>
                    </Row>
                  </Col>
                </Row>
              </Fragment>
            );
          }
        }

        return (
          <Deck transition={["zoom", "slide"]} theme={theme} transitionDuration={500} contentWidth={"90%"} contentHeight={"100%"}>
            <SlideSet style={{ border: '1px solid red' }}>
              <Slide bgColor="primary">
                <Heading transition={["slide"]} size={1} caps lineHeight={1} textColor="secondary" margin="0px 0px 50px 0px">
                  Year In Review
                </Heading>
                <Heading size={3} caps textColor="tertiary" margin="0px 0px 50px 0px">
                  2019
                </Heading>
                <Text textSize="1.5em" margin="0px 0px 50px 0px" bold textColor="black">
                  Presented by
                </Text>
                <Text textSize="1.0em" margin="0px 0px 30px 0px" bold textColor="blue">
                  David Han
                </Text>
              </Slide>
              <Slide transition={["zoom", "fade"]} bgColor="primary">
                <Text textSize="1.5em" margin="0px 0px 30px 0px" bold textColor="black">
                  US Equities Market Share
                </Text>
                <MarketShareByYearExchWithData />
              </Slide>
            </SlideSet>
          </Deck>
        );
      }
    </script>
  </body>
</html>
